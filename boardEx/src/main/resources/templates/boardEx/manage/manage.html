<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ê´€ë¦¬ì - ìŠ¤í¬ë¦½íŠ¸ ê´€ë¦¬</title>

<link href="/assets/img/thunder_icon.png" rel="icon">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link rel="stylesheet" href="/assets/css/style.css">

<style>
.btn-primary {
           background: white;
           color: var(--primary);
           padding: 0.875rem 2rem;
           border: 2px solid var(--primary);
           border-radius: 10px;
           font-size: 1rem;
           font-weight: 600;
           cursor: pointer;
           transition: all 0.3s;
           text-decoration: none;
           display: inline-flex;
           align-items: center;
           gap: 0.5rem;
}

/* ===== ì»¤ë®¤ë‹ˆí‹° ê²€ìƒ‰ ===== */
.search-box {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    /* background: white; */
    padding: 0.6rem;
    border-radius: 14px;
    /* box-shadow: 0 2px 2px rgba(0,0,0,0.06); */
}

.search-select {
    height: 42px;
    padding: 0 0.75rem;
    border-radius: 10px;
    border: 1px solid var(--border);
    font-size: 0.9rem;
    cursor: pointer;
    background: #fff;
}

.search-input {
    flex: 1;
    min-width: 0;
    height: 42px;
    padding: 0 1rem;
    border-radius: 10px;
    border: 1px solid var(--border);
    font-size: 0.95rem;
    outline: none;
}

.search-input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(99,102,241,0.15);
}

.search-btn {
	flex-shrink: 0;    
    width: 42px;
    height: 42px;
    border-radius: 10px;
    border: none;
    background: var(--primary);
    color: white;
    font-size: 1.1rem;
    cursor: pointer;
    transition: all 0.25s ease;
}

.search-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-1px);
    box-shadow: 0 6px 15px rgba(99,102,241,0.4);
}

/* ëª¨ë°”ì¼ ëŒ€ì‘ */
@media (max-width: 640px) {
    .search-box {
        flex-direction: column;
        align-items: stretch;
    }

    
}

/* ================= Pagination ================= */
	.pagination-wrapper {
	    display: flex;
	    justify-content: center;
	    align-items: center;
	    gap: 0.6rem;
	    margin-top: 3rem;
	    flex-wrap: wrap;
	}
	
	.page-btn {
	    min-width: 42px;
	    height: 42px;
	    padding: 0 14px;
	    border-radius: 12px;
	    border: 1px solid var(--border);
	    background: white;
	    color: var(--dark);
	    font-size: 0.95rem;
	    font-weight: 600;
	    display: inline-flex;
	    align-items: center;
	    justify-content: center;
	    cursor: pointer;
	    text-decoration: none;
	    transition: all 0.25s ease;
	}
	
	.page-btn:hover {
	    background: var(--primary);
	    color: #fff;
	    border-color: var(--primary);
	    transform: translateY(-2px);
	    box-shadow: 0 8px 18px rgba(99,102,241,0.35);
	}
	
	.page-btn.active {
	    background: var(--primary);
	    color: white;
	    border-color: var(--primary);
	    cursor: default;
	    box-shadow: 0 10px 25px rgba(99,102,241,0.45);
	}
	
	.page-btn.prev,
	.page-btn.next {
	    font-size: 1.25rem;
	    font-weight: 700;
	}
	
	@media (max-width: 480px) {
	    .page-btn {
	        min-width: 36px;
	        height: 36px;
	        font-size: 0.85rem;
	    }
	}

/* ===== ê´€ë¦¬ì ë²„íŠ¼ ê³µí†µ ===== */
.btn-admin.btn-primary {
    white-space: nowrap;   /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
    flex-shrink: 0;        /* flex ì•ˆì—ì„œ ì¤„ì–´ë“¤ì§€ ì•Šê²Œ */
}


.btn-admin {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 10px 14px;
    border-radius: 10px;
    font-size: 0.875rem;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--primary);
    transition: all 0.2s ease;
}

.btn-admin.primary {
    background: var(--primary);
    color: #fff;
}

.btn-admin.primary:hover {
    background: var(--primary-dark);
}

.btn-admin.outline {
    background: #fff;
    color: var(--primary);
    border: 1px solid var(--border);
}

.btn-admin.danger {
    background: #fff;
    color: var(--danger);
    border: 1px solid rgba(239,68,68,0.3);
}

.admin-wrap {
    max-width: 1200px;
    margin: 40px auto;
    background: #fff;
    border-radius: 14px;
    padding: 30px;
}

.page-header {
    display: flex;
    align-items: center;
    gap: 1rem;
}

/* ì™¼ìª½ ë¬¶ìŒ */
.page-left {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    white-space: nowrap;
}

/* ì™¼ìª½ ì œëª© */
.page-header h2 {
    white-space: nowrap;
}

/* ê²€ìƒ‰ì€ ë‚¨ëŠ” ê³µê°„ë§Œ ì‚¬ìš© */
.page-header .search-box {
    flex: 1;
    min-width: 240px;
}

/* ë²„íŠ¼ì€ ì ˆëŒ€ ì¤„ì–´ë“¤ì§€ ì•ŠìŒ */
.page-header .btn-admin {
    flex-shrink: 0;
    white-space: nowrap;
}


table {
    width: 100%;
    border-collapse: collapse;
}

th, td {
    padding: 14px;
    border-bottom: 1px solid var(--border);
    text-align: center;
    font-size: 14px;
}

th {
    background: #f3f4f6;
}

.status-open { color: #16a34a; font-weight: 600; }
.status-close { color: #dc2626; font-weight: 600; }
</style>
</head>

<body>

<!-- HEADER -->
<div th:replace="~{boardEx/header :: header}"></div>

<main class="main-content">
<div class="admin-wrap">

    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="page-header">
    	<div class="page-left">
	        <h2>ğŸ“‚ ì „ì²´ ìŠ¤í¬ë¦½íŠ¸ ê´€ë¦¬</h2>
	        <div class="count-box">
	        	<span class="count-title">(ğŸ“Œ ìŠ¤í¬ë¦½íŠ¸</span>
				<span class="count-number" th:text="${paging.total}"></span>
				<span class="count-unit">ê°œ)</span>
			</div>
		</div>
        <!-- ê²€ìƒ‰ -->
        <form action="/boardEx/manage/manage" method="get" class="search-box">
            <select name="type" class="search-select">
                <option value="ID" th:selected="${criteria.type == 'ID'}">ID</option>
                <option value="N" th:selected="${criteria.type == 'N'}">ìŠ¤í¬ë¦½íŠ¸ëª…</option>
                <option value="C" th:selected="${criteria.type == 'C'}">ì¹´í…Œê³ ë¦¬</option>
                <option value="O" th:selected="${criteria.type == 'O'}">ê³µê°œì—¬ë¶€</option>
            </select>

            <input type="text"
                   name="keyword"
                   class="search-input"
                   placeholder="ê²€ìƒ‰ì–´ ì…ë ¥"
                   th:value="${criteria.keyword}">

            <button type="submit" class="search-btn">ê²€ìƒ‰</button>
        </form>

        <button class="btn-admin btn-primary"
                onclick="location.href='/boardEx/manage/register'">
            + ìŠ¤í¬ë¦½íŠ¸ ë“±ë¡
        </button>
    </div>

    <!-- í…Œì´ë¸” -->
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>ìŠ¤í¬ë¦½íŠ¸ëª…</th>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>ê³µê°œì—¬ë¶€</th>
                <th>ì‚¬ìš©íšŸìˆ˜</th>
                <th>ë“±ë¡ì¼</th>
                <th>ê´€ë¦¬ì</th>
                <th>ê´€ë¦¬</th>
            </tr>
        </thead>

        <tbody>
            <tr th:each="script : ${scriptList}">
                <td th:text="${script.siteId}"></td>
                <td th:text="${script.name}"></td>
                <td th:text="${script.category}"></td>

                <td>
                    <span th:if="${script.openYn == 'Y'}" class="status-open">ê³µê°œ</span>
                    <span th:if="${script.openYn == 'N'}" class="status-close">ë¹„ê³µê°œ</span>
                </td>

                <td th:text="${script.useCount}"></td>
                <td th:text="${script.createdAt}"></td>
                <td th:text="${script.manager}"></td>

                <td>
                    <button class="btn-admin outline"
                            th:data-site-id="${script.siteId}"
                            onclick="goEdit(this)">
                        <i class="bi bi-pencil"></i>
                        ìˆ˜ì •
                    </button>

                    <button class="btn-admin danger"
                            th:data-site-id="${script.siteId}"
                            onclick="deleteScript(this)">
                        <i class="bi bi-trash"></i>
                        ì‚­ì œ
                    </button>
                </td>
            </tr>
        </tbody>
    </table>

    <!-- í˜ì´ì§• -->
    <div class="pagination-wrapper" th:object="${paging}">
        <div style="text-align:center">

            <!-- ì´ì „ -->
            <a class="page-btn changePage"
               th:if="*{prev}"
               href="#"
               th:data-page="${paging.startPage - 1}">
                &lt;
            </a>

            <!-- í˜ì´ì§€ ë²ˆí˜¸ -->
            <th:block th:each="num : ${#numbers.sequence(paging.startPage, paging.endPage)}">
                <span class="page-btn active"
                      th:if="${paging.criteria.pageNum == num}"
                      th:text="${num}">
                </span>

                <a class="page-btn changePage"
                   th:unless="${paging.criteria.pageNum == num}"
                   href="#"
                   th:data-page="${num}"
                   th:text="${num}">
                </a>
            </th:block>

            <!-- ë‹¤ìŒ -->
            <a class="page-btn changePage"
               th:if="*{next}"
               href="#"
               th:data-page="${paging.endPage + 1}">
                &gt;
            </a>

        </div>

        <!-- ìƒíƒœ ìœ ì§€ìš© form -->
        <form name="pageForm" action="/boardEx/manage/manage" method="get" th:object="${criteria}">
       		<!-- í˜ì´ì§•  -->
            <input type="hidden" name="pageNum" th:field="*{pageNum}">
            <input type="hidden" name="amount" th:field="*{amount}">
            <!-- ê²€ìƒ‰ ìœ ì§€ -->
            <input type="hidden" name="type" th:field="*{type}">
            <input type="hidden" name="keyword" th:field="*{keyword}">
        </form>
    </div>

</div>
</main>

<!-- FOOTER -->
<div th:replace="~{boardEx/footer :: footer}"></div>

<script src="https://code.jquery.com/jquery-3.7.1.js"></script>
<script src="/assets/js/common.js" defer></script>
<script>
function goEdit(btn) {
    const siteId = btn.dataset.siteId;
    location.href = '/boardEx/manage/modify?siteId=' + siteId;
}

function deleteScript(btn) {
    const siteId = btn.dataset.siteId;
    if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;

    fetch('/boardEx/manage/remove', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: 'siteId=' + encodeURIComponent(siteId)
    })
    .then(res => {
        if (!res.ok) throw new Error();
        return res.text();
    })
    .then(() => {
    	alert("í•´ë‹¹ ìŠ¤í¬ë¦½íŠ¸ ì‚­ì œ ì™„ë£Œ í–ˆìŠµë‹ˆë‹¤.");
        location.reload();
    })
    .catch(() => alert('ì‚­ì œ ì‹¤íŒ¨'));
}
</script>

<script th:inline="javascript">
    $("a.changePage").on("click", function (e) {
        e.preventDefault();

        const page = $(this).data("page");
        const pageForm = document.pageForm;

        pageForm.pageNum.value = page;
        pageForm.submit();
    });
    
[[${msg}]] && alert([[${msg}]]);
</script>

</body>
</html>
