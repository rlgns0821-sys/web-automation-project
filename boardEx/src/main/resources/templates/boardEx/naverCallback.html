<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Naver Login Callback</title>
  <script src="https://static.nid.naver.com/js/naveridlogin_js_sdk_2.0.2.js"></script>
</head>
<body>

<script>
  const naverLogin = new naver.LoginWithNaverId({
    clientId: "Py1P1aUvHuoyfJZP_HKq",
    callbackUrl: "http://localhost:10001/boardEx/naverCallback"
  });

  naverLogin.init();

  window.onload = function () {
	  naverLogin.getLoginStatus(function (status) {
	    if (!status) {
	      location.href = "/boardEx/login";
	      return;
	    }

	    const email = naverLogin.user.getEmail();
	    const name  = naverLogin.user.getName();

	    if (!email || !name) {
	      alert("ë„¤ì´ë²„ ë¡œê·¸ì¸ í•„ìˆ˜ ì •ë³´ ë™ì˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.");
	      location.href = "/boardEx/login";
	      return;
	    }

	    // âœ… ì—¬ê¸°ì„œ loginId ìƒì„±ë¨ (ë„¤ê°€ ì°¾ë˜ ê·¸ ì½”ë“œ)
	    const loginId   = email.split("@")[0];
	    const loginName = name;

	    // ðŸ”¥ ì„œë²„ì— ì„¸ì…˜ ìƒì„± (ì´ê²Œ í•µì‹¬)
	    fetch("/boardEx/login", {
	      method: "POST",
	      headers: {
	        "Content-Type": "application/json"
	      },
	      credentials: "same-origin",
	      body: JSON.stringify({
	        loginId: loginId,
	        loginName: loginName
	      })
	    }).then(() => {
	      // UIìš©
	      sessionStorage.setItem("loginId", loginId);
	      sessionStorage.setItem("loginName", loginName);

	      location.href = "/";
	    });
	  });
	};
</script>
</body>
</html>
