<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ÏûêÎèôÏòàÎß§ - Ïª§ÎÆ§ÎãàÌã∞ ÏÉÅÏÑ∏</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
<link href="/assets/img/thunder_icon.png" rel="icon">
 <link rel="stylesheet" href="/assets/css/comment.css">
<style>
	:root {
	    --primary: #6366f1;
	}

	.scroll-top {
	    position: fixed;
	    right: 20px;
	    bottom: 20px;
	    width: 48px;
	    height: 48px;
	    background: var(--primary);
	    color: white;
	    border-radius: 50%;
	    display: flex;
	    align-items: center;
	    justify-content: center;
	    font-size: 1.5rem;
	    cursor: pointer;
	    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
	    z-index: 9999;
	
	    opacity: 0;
	    pointer-events: none;
	    transition: opacity 0.3s, transform 0.3s;
	}
	
	.scroll-top.show {
	    opacity: 1;
	    pointer-events: auto;
	}
	
	.scroll-top:hover {
	    transform: translateY(-3px);
	}

	.comment-wrapper {
	    margin-top: 20px;
	    padding-top: 20px;
	    border-top: 1px solid #e5e7eb;
	}
	
	
    body {
        background: #f8fafc;
        font-family: system-ui, sans-serif;
    }
    
    .tag {
            padding: 0.375rem 0.875rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
    }
    
    .tag-ticket {
            background: rgba(168, 85, 247, 0.1);
            color: #7c3aed;
    }
    
    .read-container {
        max-width: 900px;
        margin: 60px auto;
        background: #fff;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0,0,0,.05);
    }
    .header {
        border-bottom: 1px solid #e5e7eb;
        padding-bottom: 15px;
        margin-bottom: 20px;
    }
    .header h2 {
        margin: 0;
        font-size: 22px;
    }
    .meta {
        margin-top: 8px;
        font-size: 13px;
        color: #64748b;
        display: flex;
        gap: 15px;
    }
    .content-box {
        white-space: pre-wrap;
        line-height: 1.8;
        font-size: 15px;
        color: #334155;
        margin-top: 30px;
    }
    .info-box {
        background: #f1f5f9;
        padding: 12px;
        border-radius: 8px;
        font-size: 14px;
        margin-top: 20px;
        display: flex;
        gap: 20px;
    }
    .btn-area {
        margin-top: 30px;
        display: flex;
        justify-content: space-between;
    }
    .btn {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
    }
    .btn-primary {
        background: #6366f1;
        color: #fff;
    }
    .btn-gray {
        background: #e5e7eb;
    }
    .btn-danger {
        background: #ef4444;
        color: #fff;
    }
</style>
</head>

<body>
<div class="read-container" th:object="${vo}">
	<input type="hidden" id="postId" th:value="${vo.postId}">

    <!-- Ï†úÎ™© ÏòÅÏó≠ -->
    <div class="header">
        <h2>[[*{postId}]] : [[*{title}]]</h2>
        
        <div class="meta">
            <span>ÏûëÏÑ±Ïûê: [[*{author}]]</span>
            <span>Ïπ¥ÌÖåÍ≥†Î¶¨: [[*{category}]]</span>
            <span>Îì±Î°ùÏùº: [[*{createdAt}]]</span>
            <span>‚ù§Ô∏è [[*{likes}]]</span>
        </div>
    </div>

    <!-- Ìã∞Ïºì Ï†ïÎ≥¥ -->
    <div class="info-box">
        <div>Ìã∞Ïºì Ï¢ÖÎ•ò: <b class="tag tag-ticket">[[*{ticket}]]</b></div>
        <div>üí¨ ÎåìÍ∏Ä Ïàò: <b th:text="${commentList.size()}"></b></div>
    </div>

    <!-- Î≥∏Î¨∏ -->
    <div class="content-box">
        [[*{content}]]
    </div>

    <!-- Î≤ÑÌäº ÏòÅÏó≠ -->
    <div class="btn-area">
        <button class="btn btn-gray"
                th:onclick="|location.href='@{/boardEx/community(
                	  				  pageNum=${criteria.pageNum}
                	  				, amount=${criteria.amount}
                	  				, type=${criteria.type}
                	  				, keyword=${criteria.keyword}
               	  				 )}'|"	>
            Î™©Î°ù
        </button>
        <div>
            <!-- ÏûëÏÑ±Ïûê Î≥∏Ïù∏Ïùº ÎïåÎßå ÎÖ∏Ï∂ú Í∞ÄÎä• -->
            <button class="btn btn-primary"
                    th:if="${session.loginName == vo.author or session.loginName == 'ÌëúÍ∏∞Ìõà' or session.loginName == 'Ïù¥Ïû•Ïö±'}"
                    th:onclick="|location.href='@{/boardEx/comModify(postId=${vo.postId})}'|">
                ÏàòÏ†ï
            </button>

            <button class="btn btn-danger"
                    th:if="${session.loginName == vo.author or session.loginName == 'ÌëúÍ∏∞Ìõà' or session.loginName == 'Ïù¥Ïû•Ïö±'}"
                    th:onclick="|location.href='@{/boardEx/comRemove(postId=${vo.postId})}'|">
                ÏÇ≠Ï†ú
            </button>
        </div>
    </div>
    <!-- ÎåìÍ∏Ä ÏòÅÏó≠ -->
    <section class="comment-section">
		<div th:replace="~{boardEx/comments/comments :: commentSection}"></div>
	</section>
</div>
<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
</body>
<script>
	const scrollTopBtn = document.getElementById("scroll-top");
	//Ïä§ÌÅ¨Î°§ Ïãú Î≤ÑÌäº ÌëúÏãú
	window.addEventListener("scroll", () => {
	if (window.scrollY > 300) {
	  scrollTopBtn.classList.add("show");
	} else {
	  		scrollTopBtn.classList.remove("show");
		}
	});
	
	//ÌÅ¥Î¶≠ Ïãú Îß® ÏúÑÎ°ú Ïù¥Îèô
	scrollTopBtn.addEventListener("click", (e) => {
		e.preventDefault();
		window.scrollTo({
		  top: 0,
		  behavior: "smooth"
		});
	});

  const textarea = document.getElementById("commentContent");
  const len = document.getElementById("commentLen");

  if (textarea) {
    textarea.addEventListener("input", () => {
      len.textContent = textarea.value.length;
    });
  }

  function submitComment() {
	  const textarea = document.getElementById("commentContent");
	  const postId = document.getElementById("postId").value;
	  const loginInfo = document.getElementById("commentLoginInfo");

	  if (!loginInfo || loginInfo.dataset.login !== "true") {
	    alert("Î°úÍ∑∏Ïù∏Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§.");
	    location.href = "/boardEx/login";
	    return;
	  }

	  const content = textarea.value.trim();
	  if (!content) {
	    alert("ÎåìÍ∏ÄÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî.");
	    return;
	  }

	  fetch("/boardEx/comments/insert", {
	    method: "POST",
	    headers: { "Content-Type": "application/x-www-form-urlencoded" },
	    body: `postId=${postId}&content=${encodeURIComponent(content)}`
	  })
	  .then(res => res.text())
	  .then(msg => {
	    alert(msg);
	    location.reload();
	  });
	}


  function deleteComment(btn) {
    if (!confirm("ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) return;

    const item = btn.closest(".comment-item");
    const commentId = item.dataset.commentId;

    fetch("/boardEx/comments/delete", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `commentId=${commentId}`
    })
    .then(() => location.reload());
  }

  function editComment(btn) {
    const item = btn.closest(".comment-item");
    const body = item.querySelector(".comment-body");
    const next = prompt("ÎåìÍ∏Ä ÏàòÏ†ï", body.textContent);
    if (!next) return;

    fetch("/boardEx/comments/update", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: `commentId=${item.dataset.commentId}&content=${encodeURIComponent(next)}`
    })
    .then(() => location.reload());
  }
</script>
<script src="/assets/js/common.js" defer></script>
</html>